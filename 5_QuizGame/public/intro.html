<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./lib/bootstrap.min.css">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"  />

    <link rel="stylesheet" href="css/intro.css">
</head>
<body background="images/backdrop.png">
    <br><br><br><br>

    <div class="container-fluid no-gutters">
        <div class="row justify-content-center">
            <div class="col-sm-3 ">
                <img src="images/logo.png" class="img-fluid" >
            </div>
        </div>
        <div class="row ">

            <div class="offset-3 col-sm-2 text-center">
                <button class="btn btn-danger pl-4 pr-4" data-toggle="modal" data-target="#modal_JoinNewGame" data-dismiss="modal" >Join Game</button>
            </div>
            <div class="offset-2 col-sm-2 text-center">
                <button id="btn_StartGame" class="btn btn-danger pl-4 pr-4 text-center">Start new Game</button>
            </div>
        </div>

    </div>

    <div class="modal fade" id="modal_JoinNewGame" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Join a Game</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label>Game Code:</label>
                    <input id="input_JoinGameCode" class="form-control" type="text" placeholder="6 Digit Code">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button id="btn_JoinGame" type="button" class="btn text-white" style="background-color: #075B51" data-dismiss="modal">Join</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal_ShowGameCode" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Start New Game</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label>Share this Game code with another user</label>
                    <input id="input_InviteGameCode" class="form-control" type="text" placeholder="6 Digit Code" disabled>
                    <br><Br>
                    <div class="offset-3 col-sm-6">
                        <div class="progress" style="height: 50px">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                                <b>Player 1 (Ready)</b>
                            </div>
                        </div>
                    </div>
                    <br>

                    <div class="offset-3 col-sm-6">
                    <div class="progress" style="height: 50px">
                        <div id="progressBar_Player2" class=" progress-bar progress-bar-striped  bg-danger" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                            <b>Player 2 (Waiting)</b>
                        </div>
                    </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button id="btn_PlayGame" type="button" class="btn btn-dark">
                        PLAY
                        <div class="spinner-border text-light spinner-border-sm" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>









    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" ></script>-->
    <script src="./lib/jquery.min.js" ></script>
    <script src="./lib/bootstrap.bundle.min.js" ></script>
    <script src="./lib/socket.io.min.js" ></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>-->
<script>
  const socket = io('http://localhost:4001') ;
  localStorage.setItem('currentGameCode', '-1') ;


    $('#btn_StartGame').click(()=> {
      socket.emit('C2S_RequestNewGame', {
        sender: localStorage.getItem('senderName')
      }, (serverAcknowledgement) => {
        if (serverAcknowledgement = true) {
          // TODO maybe show a loading bar here
        }
      });

    }) ;


    socket.on('S2C_NewGameStarted', (data)=>{
      let gameCode = data.gameroom.gameCode ;
      console.log("Gamecode is " + gameCode) ;

      document.querySelector('#input_InviteGameCode').value = gameCode ;
      $('#modal_ShowGameCode').modal('show') ;
    }) ;




    $('#btn_JoinGame').click(()=>{
      let gameCode = document.querySelector('#input_JoinGameCode').value ;
      if(gameCode == null || gameCode == ''){
        console.log('Please enter a game code') ;
        return ;
      }

      socket.emit('C2S_JoinGame', {
        gameCode : gameCode,
        sender : localStorage.getItem('senderName')
      }, (serverAcknowledgement)=>{
        if(serverAcknowledgement){
          // TODO show a loading bar here
        }
      }) ;

    }) ;


    socket.on('S2C_NewGameJoined', (data)=>{
        let gameCode = data.gameroom.gameCode ;
        console.log("Gamecode is " + gameCode) ;
        //TODO check that there are two players in the room & then move this player to the GamePlay page
      if(data.gameroom.players.length == 2){
        localStorage.setItem('currentGameCode', data.gameroom.gameCode) ;
        window.location.href = 'game.html';
      }
    }) ;

    socket.on('S2C_NewUserJoinedGame', (data)=>{
      console.log(`new User has joined the game ${data.gameroom.gameCode} ${data.newUserName}`) ;
      $('#progressBar_Player2').removeClass('bg-danger') ;
      $('#progressBar_Player2').addClass('bg-success') ;

      if(data.gameroom.players.length == 2){
        localStorage.setItem('currentGameCode', data.gameroom.gameCode) ;
        window.location.href = 'game.html';
      }
      //TODO check that there are two players in the room & then move this player to the GamePlay page

    }) ;


    socket.on('S2C_Error', (data)=>{
      console.log('error : ' + data.e) ;
    }) ;


    function startGame(){
        //this function will be attached to the click listener of btn_PlayGame when two players will join the gameroom

    }


    //TODO remove the user on disconnect














</script>
</body>